# ------------------------------------------------------------------------------
# templates/core/namespaces.yaml
# ------------------------------------------------------------------------------
# Step 6 of the 28-step build sequence.
# Creates Kubernetes Namespace resources for all namespaces defined in values/base.yaml.
# This is always applied before workloads, so other manifests can safely reference them.
# Works with both simple string values (current base.yaml) and extended object definitions.
# ------------------------------------------------------------------------------

{{- /*
Support two formats in values/base.yaml:
1. Simple key-value (string) for basic namespace naming:
   namespaces:
     inference: inference
     monitoring: monitoring
2. Full object for advanced config:
   namespaces:
     inference:
       name: inference
       workloadType: compute
       env: staging
       annotations:
         foo: bar
*/ -}}

{{- range $key, $val := .Values.namespaces }}
---
apiVersion: v1
kind: Namespace
metadata:
  # If value is a string, use it directly. If it's a map, use .name
  name: {{- if kindIs "string" $val }} {{ $val }} {{- else }} {{ $val.name }} {{- end }}
  labels:
    name: {{- if kindIs "string" $val }} {{ $val }} {{- else }} {{ $val.name }} {{- end }}
    # workload-type is optional; defaults to the namespace key if not set
    workload-type: {{- if and (not (kindIs "string" $val)) $val.workloadType }} {{ $val.workloadType }} {{- else }} {{ $key }} {{- end }}
    env: {{- if and (not (kindIs "string" $val)) $val.env }} {{ $val.env }} {{- else }} production {{- end }}
  {{- if and (not (kindIs "string" $val)) $val.annotations }}
  annotations:
{{ toYaml $val.annotations | indent 4 }}
  {{- end }}
{{- end }}
